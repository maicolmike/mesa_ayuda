{% extends 'base.html' %}
{% load static %}

{% block sinNada %}
<div class="container-fluid" style="padding-top: 35px;padding-left: 50px;padding-right: 50px;">
    <div class="card shadow table-responsive">
        <div class="card-body table-responsive">
          {% include 'messages.html' %}
            <h4 style="text-align: center;"><b>Listado de requerimientos</b></h4>
            <table id="example1" class="table table-bordered table-hover">
                <thead class="table-secondary">
                    <tr>
                        <th class="sorting sorting_asc">Id</th>
                        <th>Título</th>
                        <th>Descripción</th>
                        <th>Clasificación</th>
                        <th>Sub Clasificación</th>
                        <th>Estado</th>
                        <th>Usuario</th>
                        <th>Fecha</th>
                        <th>Detalles</th>
                        <th>Agregar novedad</th>
                        {% if usuario.is_superuser == 1 %} 
                        <th>Cerrar caso</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                {% for requerimiento in requerimientos %}
                    <tr>
                        <td>{{ requerimiento.id }}</td>
                        <td>{{ requerimiento.titulo }}</td>
                        <td>
                            {{ requerimiento.descripcion|truncatechars:210 }} <!-- Muestra solo los primeros 100 caracteres -->
                            {% if requerimiento.descripcion|length > 210 %} 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#modalVerMas{{ requerimiento.id }}">Ver más</a>
                            {% endif %}
                        </td>
                        <td>{{ requerimiento.clasificacion }}</td>
                        <td>{{ requerimiento.sub_clasificacion }}</td>
                        <td>{{ requerimiento.estado }}</td>
                        <td>{{ requerimiento.usuario.username }}</td>
                        <td>{{ requerimiento.fecha }}</td>
                        <td style="text-align: center;">
                            <a href="{% url 'detalle_requerimiento' requerimiento.id %}" class="btn btn-success fa-solid fa-calendar-check"></a>
                        </td>
                        <td style="text-align: center;">
                            <a href="{% url 'agregar_novedad' requerimiento.id %}" class="btn btn-info fa-solid fa-check"></a>
                        </td>
                        {% if usuario.is_superuser == 1 %}
                        <td style="text-align: center;">
                            <a href="#" class="btn btn-danger fa-solid fa-xmark" data-bs-toggle="modal" data-bs-target="#modalCerrar{{ requerimiento.id }}"></a>
                        </td>
                        {% endif %}
                        
                        {% include 'requerimientos/modalDetalleRequerimiento.html' %}
                        {% include 'requerimientos/modalAgregarNovedad.html' %}
                        {% include 'requerimientos/modalEliminarRequerimiento.html' %}


                        <!-- Modal Ver Más -->
                        <div class="modal fade" id="modalVerMas{{ requerimiento.id }}" tabindex="-1" aria-labelledby="modalVerMasLabel{{ requerimiento.id }}" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="modalVerMasLabel{{ requerimiento.id }}">Descripción Completa</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        {{ requerimiento.descripcion }}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cerrar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Fin Modal Ver Más -->

                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
